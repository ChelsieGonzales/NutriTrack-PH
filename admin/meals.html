<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pinggang Pinoy | NutriTrack PH</title>
  <link rel="stylesheet" href="admin-dashboard.css">
</head>
<body>

<aside class="sidebar">
  <div class="brand"><h1>NutriTrack PH</h1></div>
  <nav class="nav">
    <button class="nav-link" onclick="location.href='admin-dashboard.html'">Home</button>
    <button class="nav-link" onclick="location.href='add-child.html'">Add Child</button>
    <button class="nav-link" onclick="location.href='children-list.html'">Children List</button>
    <button class="nav-link active">Reports</button>
    <button class="nav-link" onclick="location.href='meals.html'">Meal Plans</button>
    <button class="nav-link logout" id="logoutBtn">Logout</button>
  </nav>
</aside>

<main class="main">
  <h2>Pinggang Pinoy - Schedule Meals</h2>

  <div class="schedule-form">
    <label for="childSelect">Select Child:</label>
    <select id="childSelect"></select>

    <label for="mealDate">Select Date:</label>
    <input type="date" id="mealDate">

    <label for="mealType">Meal:</label>
    <select id="mealType">
      <option value="Breakfast">Breakfast</option>
      <option value="Lunch">Lunch</option>
      <option value="Dinner">Dinner</option>
    </select>

    <label for="menu">Menu:</label>
    <select id="menu">
      <option value="Arroz Caldo">Arroz Caldo with egg</option>
      <option value="Adobo">Adobong Manok with Kangkong</option>
      <option value="Pinakbet + grilled bangus">Pinakbet with bangus</option>
    </select>

    <button class="btn primary" id="scheduleMeal">Schedule Meal</button>
  </div>

  <h3>Scheduled Meals</h3>
  <ul id="scheduledMealsList"></ul>
</main>

<script>
const STORAGE_KEY = 'PINGGANG_PINOY_SCHEDULE';

function readChildren() {
  try {
    return JSON.parse(localStorage.getItem('NUTRI_CHILDREN_V1') || '[]');
  } catch(e) {
    return [];
  }
}

function readScheduledMeals() {
  try {
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  } catch(e) {
    return [];
  }
}

function populateChildren() {
  const select = document.getElementById('childSelect');
  const children = readChildren();
  select.innerHTML = '';
  children.forEach(child => {
    const option = document.createElement('option');
    option.value = child.name;
    option.textContent = `${child.name} (${child.school})`;
    select.appendChild(option);
  });
}

function renderScheduledMeals() {
  const list = document.getElementById('scheduledMealsList');
  const meals = readScheduledMeals();
  list.innerHTML = '';
  meals.forEach(item => {
    const li = document.createElement('li');
    li.textContent = `${item.date} - ${item.child}: ${item.meal} â†’ ${item.menu}`;
    list.appendChild(li);
  });
}

document.getElementById('scheduleMeal').addEventListener('click', () => {
  const child = document.getElementById('childSelect').value;
  const date = document.getElementById('mealDate').value;
  const meal = document.getElementById('mealType').value;
  const menu = document.getElementById('menu').value;

  if(!child || !date) {
    alert('Please select a child and date.');
    return;
  }

  const scheduledMeals = readScheduledMeals();
  scheduledMeals.push({ child, date, meal, menu });
  localStorage.setItem(STORAGE_KEY, JSON.stringify(scheduledMeals));
  renderScheduledMeals();
  alert('Meal scheduled successfully!');
});

document.addEventListener('DOMContentLoaded', () => {
  populateChildren();
  renderScheduledMeals();
});

document.getElementById('logoutBtn').addEventListener('click', () => {
  window.location.href = "admin.html";
  });
</script>
</body>
</html>
