<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Children List | NutriTrack PH</title>
  <link rel="stylesheet" href="admin-dashboard.css">
</head>
<body>

<aside class="sidebar">
  <div class="brand"><h1>NutriTrack PH</h1></div>
  <nav class="nav">
    <button class="nav-link" onclick="location.href='admin-dashboard.html'">Home</button>
    <button class="nav-link" onclick="location.href='add-child.html'">Add Child</button>
    <button class="nav-link active">Children List</button>
    <button class="nav-link" onclick="location.href='reports.html'">Reports</button>
    <button class="nav-link" onclick="location.href='meals.html'">Meal Plans</button>
    <button class="nav-link logout" id="logoutBtn">Logout</button>
  </nav>
</aside>

<main class="main">
  <h2>Children Records</h2>
  <div class="top-actions">
    <input id="searchInput" placeholder="Search name / barangay..." aria-label="search">
    <button class="btn" onclick="location.href='add-child.html'">+ Add Child</button>
  </div>
  <div class="table-wrap">
    <table id="childrenTable" class="table">
      <thead>
        <tr>
          <th>Name</th><th>Age</th><th>Barangay</th><th>Weight (kg)</th>
          <th>Height (cm)</th><th>BMI</th><th>Status</th><th>Added</th><th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</main>

<style>
    :root{
  --teal:#2c7a7b;
  --muted:#6c7a7a;
  --card:#fff;
  --bg:#f6f9f9;
  --radius:10px;
}

*{
  box-sizing:border-box
}

body{
  font-family: 'Montserrat', sans-serif; 
  margin:0; background:var(--bg); 
  color:#123;
}

a{
  color:inherit
}

.sidebar{
  width:260px;
  background:var(--teal);
  color:#fff;
  min-height:100vh;
  padding:22px;
  position:fixed;
  left:0; top:0;
}

.nav{
  display:flex; 
  flex-direction:column; 
  gap:8px; 
  margin-top:8px
}

.nav .nav-link{
  background:transparent; 
  color:white; 
  border:none; 
  text-align:left;
  padding:10px 12px; 
  border-radius:8px; 
  cursor:pointer; 
  font-size:16px;
}

.nav .nav-link.active, .nav .nav-link:hover{
  background:rgba(0,0,0,0.06); 
  opacity:0.95}

.main{
  margin-left:260px;
  padding:28px;
  min-height:100vh;
}

.table-wrap{
  overflow:auto
}

.table{
  width:100%; 
  border-collapse:collapse; text-align:left
}

.table th, .table td{
  padding:10px 8px; 
  border-bottom:1px solid #eef6f5
}

.table th{
  background:#f9fbfb; 
  color:var(--teal); 
  font-weight:700
}

.action-btn {
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 12px;
  cursor: pointer;
  border: none;
}

.action-btn.edit {
  background: #2c7a7b;
  color: white;
}

.action-btn.delete {
  background: #e63946;
  color: white;
}
</style>

<script>
const STORAGE_KEY = 'NUTRI_CHILDREN_V1';

function readChildren() {
  try {
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  } catch (e) {
    return [];
  }
}

function searchFilter(q){
  const list = readChildren();
  if(!q) return renderTable(list);
  const low = q.toLowerCase();
  const filtered = list.filter(c =>
    (c.name || '').toLowerCase().includes(low) ||
    (c.barangay || '').toLowerCase().includes(low)
  );
  renderTable(filtered);
}

function renderTable(list) {
  const tableBody = document.querySelector('#childrenTable tbody');
  if (!tableBody) return;

  tableBody.innerHTML = '';

  if (!list.length) {
    tableBody.innerHTML = `
      <tr>
        <td colspan="9" style="text-align:center; color:#777;">No records found</td>
      </tr>`;
    return;
  }

  list.forEach((child, index) => {
  const row = document.createElement('tr');

  row.innerHTML = `
    <td>${child.name}</td>
    <td>${child.age}</td>
    <td>${child.barangay || 'â€”'}</td>
    <td>${child.weight} kg</td>
    <td>${child.height} cm</td>
    <td>${child.bmi}</td>
    <td>${child.status}</td>
    <td>${new Date(child.created).toLocaleDateString()}</td>
    <td>
      <button class="action-btn edit" onclick="editChild(${index})">Update</button>
      <button class="action-btn delete" onclick="deleteChild(${index})">Delete</button>
    </td>
  `;

  tableBody.appendChild(row);
});
}

function deleteChild(i) {
  const list = readChildren();
  if (!confirm("Are you sure you want to delete this child record?")) return;

  list.splice(i, 1);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
  renderTable(list);
}


function editChild(i) {
  const list = readChildren();
  const c = list[i];

  const name = prompt("Update name:", c.name);
  if (name === null) return;

  const age = prompt("Update age:", c.age);
  if (age === null) return;

  const barangay = prompt("Update barangay:", c.barangay);
  if (barangay === null) return;

  const weight = prompt("Update weight (kg):", c.weight);
  if (weight === null) return;

  const height = prompt("Update height (cm):", c.height);
  if (height === null) return;

  const hMeters = height / 100;
  const bmi = (weight / (hMeters * hMeters)).toFixed(1);

  let status = "";
  if (bmi < 18.5) status = "Underweight";
  else if (bmi < 25) status = "Healthy";
  else if (bmi < 30) status = "Overweight";
  else status = "Obese";

  c.name = name;
  c.age = age;
  c.barangay = barangay;
  c.weight = weight;
  c.height = height;
  c.bmi = bmi;
  c.status = status;

  localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
  renderTable(list);
}

document.addEventListener('DOMContentLoaded', () => {
  renderTable(readChildren());
});

document.getElementById('searchInput').addEventListener('input', (e) => {
  searchFilter(e.target.value);
});

document.getElementById('logoutBtn').addEventListener('click', () => {
  window.location.href = 'admin.html';
});
</script>


</body>
</html>
